{"version":3,"sources":["./src/ui/ResultsPerPage/ResultsPerPage.ts","./sass/_ResultsPerPage.scss"],"names":[],"mappings":"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","file":"ResultsPerPage__1a4919568d31ada5f0d0.js","sourcesContent":["import { Component } from '../Base/Component';\nimport { IComponentBindings } from '../Base/ComponentBindings';\nimport { ComponentOptions } from '../Base/ComponentOptions';\nimport { Initialization } from '../Base/Initialization';\nimport { QueryEvents, IQuerySuccessEventArgs, INoResultsEventArgs } from '../../events/QueryEvents';\nimport { analyticsActionCauseList, IAnalyticsResultsPerPageMeta, IAnalyticsActionCause } from '../Analytics/AnalyticsActionListMeta';\nimport { Assert } from '../../misc/Assert';\nimport { $$ } from '../../utils/Dom';\nimport { KeyboardUtils, KEYBOARD } from '../../utils/KeyboardUtils';\nimport { DeviceUtils } from '../../utils/DeviceUtils';\nimport * as _ from 'underscore';\nimport { exportGlobally } from '../../GlobalExports';\nimport { l } from '../../strings/Strings';\n\nimport 'styling/_ResultsPerPage';\n\nexport interface IResultsPerPageOptions {\n  choicesDisplayed?: number[];\n  initialChoice?: number;\n}\n\n/**\n * The ResultsPerPage component attaches itself to a `div` and allows the end user to choose how many results to\n * display per page.\n *\n * **Note:** Adding a ResultPerPage component to your page overrides the value of\n * {@link SearchInterface.options.resultsPerPage}.\n */\nexport class ResultsPerPage extends Component {\n  static ID = 'ResultsPerPage';\n\n  static doExport = () => {\n    exportGlobally({\n      ResultsPerPage: ResultsPerPage\n    });\n  };\n\n  /**\n   * The options for the ResultsPerPage\n   * @componentOptions\n   */\n  static options: IResultsPerPageOptions = {\n    /**\n     * Specifies the possible values of number of results to display per page that the end user can select from.\n     *\n     * See also {@link ResultsPerPage.options.initialChoice}.\n     *\n     * Default value is `[10, 25, 50, 100]`.\n     */\n    choicesDisplayed: ComponentOptions.buildCustomListOption<number[]>(\n      function(list: string[]) {\n        let values = _.map(list, function(value) {\n          return parseInt(value, 10);\n        });\n        return values.length == 0 ? null : values;\n      },\n      {\n        defaultFunction: () => {\n          if (DeviceUtils.isMobileDevice()) {\n            return [10, 25, 50];\n          } else {\n            return [10, 25, 50, 100];\n          }\n        }\n      }\n    ),\n    /**\n     * Specifies the value to select by default for the number of results to display per page.\n     *\n     * Default value is the first value of {@link ResultsPerPage.options.choicesDisplayed}.\n     */\n    initialChoice: ComponentOptions.buildNumberOption()\n  };\n\n  private currentResultsPerPage: number;\n  private span: HTMLElement;\n  private list: HTMLElement;\n\n  /**\n   * Creates a new ResultsPerPage. The component renders itself on every query success.\n   * @param element The HTMLElement on which to instantiate the component (normally a `div`).\n   * @param options The options for the ResultsPerPage component.\n   * @param bindings The bindings that the component requires to function normally. If not set, these will be\n   * automatically resolved (with a slower execution time).\n   */\n  constructor(public element: HTMLElement, public options?: IResultsPerPageOptions, bindings?: IComponentBindings) {\n    super(element, ResultsPerPage.ID, bindings);\n    this.options = ComponentOptions.initComponentOptions(element, ResultsPerPage, options);\n\n    this.currentResultsPerPage = this.getInitialChoice();\n    this.queryController.options.resultsPerPage = this.currentResultsPerPage;\n\n    this.bind.onRootElement(QueryEvents.querySuccess, (args: IQuerySuccessEventArgs) => this.handleQuerySuccess(args));\n    this.bind.onRootElement(QueryEvents.queryError, () => this.handleQueryError());\n    this.bind.onRootElement(QueryEvents.noResults, (args: INoResultsEventArgs) => this.handleNoResults());\n    this.initComponent(element);\n  }\n\n  /**\n   * Sets the current number of results per page, then executes a query.\n   *\n   * Also logs an event in the usage analytics (`pagerResize` by default) with the new current number of results per\n   * page as meta data.\n   * @param resultsPerPage The new number of results per page to select.\n   * @param analyticCause The event to log in the usage analytics.\n   */\n  public setResultsPerPage(resultsPerPage: number, analyticCause: IAnalyticsActionCause = analyticsActionCauseList.pagerResize) {\n    Assert.exists(resultsPerPage);\n    Assert.check(\n      this.options.choicesDisplayed.indexOf(resultsPerPage) != -1,\n      'The specified number of results is not available in the options.'\n    );\n    this.searchInterface.resultsPerPage = resultsPerPage;\n    this.currentResultsPerPage = resultsPerPage;\n    this.usageAnalytics.logCustomEvent<IAnalyticsResultsPerPageMeta>(\n      analyticCause,\n      { currentResultsPerPage: this.currentResultsPerPage },\n      this.element\n    );\n    this.queryController.executeQuery({\n      ignoreWarningSearchEvent: true,\n      keepLastSearchUid: true,\n      origin: this\n    });\n  }\n\n  private getInitialChoice(): number {\n    let initialChoice = this.options.choicesDisplayed[0];\n    if (this.options.initialChoice !== undefined) {\n      if (this.options.choicesDisplayed.indexOf(this.options.initialChoice) > -1) {\n        initialChoice = this.options.initialChoice;\n      } else {\n        this.logger.warn(\n          'The initial number of results is not within the choices displayed. Consider setting a value that can be selected. The first choice will be selected instead.'\n        );\n      }\n    }\n    return initialChoice;\n  }\n\n  private initComponent(element: HTMLElement) {\n    this.span = $$(\n      'span',\n      {\n        className: 'coveo-results-per-page-text'\n      },\n      l('ResultsPerPage')\n    ).el;\n    element.appendChild(this.span);\n    this.list = $$('ul', {\n      className: 'coveo-results-per-page-list'\n    }).el;\n    element.appendChild(this.list);\n  }\n\n  private render() {\n    $$(this.span).removeClass('coveo-results-per-page-no-results');\n    let numResultsList: number[] = this.options.choicesDisplayed;\n    for (var i = 0; i < numResultsList.length; i++) {\n      let listItem = $$('li', {\n        className: 'coveo-results-per-page-list-item',\n        tabindex: 0\n      });\n      if (numResultsList[i] == this.currentResultsPerPage) {\n        listItem.addClass('coveo-active');\n      }\n\n      ((resultsPerPage: number) => {\n        let clickAction = () => this.handleClickPage(numResultsList[resultsPerPage]);\n        listItem.on('click', clickAction);\n        listItem.on('keyup', KeyboardUtils.keypressAction(KEYBOARD.ENTER, clickAction));\n      })(i);\n\n      listItem.el.appendChild(\n        $$(\n          'a',\n          {\n            className: 'coveo-results-per-page-list-item-text'\n          },\n          numResultsList[i].toString()\n        ).el\n      );\n      this.list.appendChild(listItem.el);\n    }\n  }\n\n  private handleQueryError() {\n    this.reset();\n  }\n\n  private handleNoResults() {\n    this.reset();\n  }\n\n  private handleQuerySuccess(data: IQuerySuccessEventArgs) {\n    if (this.searchInterface.isResultsPerPageModifiedByPipeline) {\n      this.logger.info('Results per page was modified by backend code (query pipeline). ResultsPerPage component will be hidden', this);\n      this.reset();\n      this.currentResultsPerPage = this.getInitialChoice();\n      this.searchInterface.resultsPerPage = this.currentResultsPerPage;\n      return;\n    }\n\n    if (data.results.results.length != 0) {\n      this.reset();\n      this.render();\n    }\n  }\n\n  private handleClickPage(resultsPerPage: number) {\n    Assert.exists(resultsPerPage);\n    this.setResultsPerPage(resultsPerPage);\n  }\n\n  private reset() {\n    $$(this.span).addClass('coveo-results-per-page-no-results');\n    $$(this.list).empty();\n  }\n}\n\nInitialization.registerAutoCreateComponent(ResultsPerPage);\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/ResultsPerPage/ResultsPerPage.ts","// removed by extract-text-webpack-plugin\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./sass/_ResultsPerPage.scss\n// module id = 439\n// module chunks = 61 78"],"sourceRoot":""}